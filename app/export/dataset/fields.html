<fieldset>
    <h4>Select fields to add to dataset</h4>
    <div class="row">


        <div class="col-md-6">
            <div class="row m-b-sm">
                <div class="col-md-8">
                    <h5>Available Fields</h5>
                    <!--<a class="btn btn-primary" data-drag="true" data-jqyoui-options="{revert: 'invalid'}" ng-model="fldCtrl.list1" jqyoui-draggable="{animate:true}" ng-hide="!fldCtrl.list1.title">{{fldCtrl.list1.title}}</a>-->
                </div>
                <!--<div class="drag" style="padding:5px; display:inline-block; background:red; border-radius:4px;">Drag me</div>-->
                <!--<div id="tree" class="jstree jstree-default"></div>-->


                <script>
                    $(function () {
//                        $('#tree').jstree({
//                            'plugins': [ 'dnd' ]
//                        });

//                        $('.drag')
//                                .on('mousedown', function (e) {
//                                    return $.vakata.dnd.start(e, { 'jstree' : true, 'obj' : $(this), 'nodes' : [{ id : true, text: $(this).text() }] }, '<div id="jstree-dnd" class="jstree-default"><i class="jstree-icon jstree-er"></i>' + $(this).text() + '</div>');
//                                });
                        /*$(document)
                                .on('dnd_move.vakata', function (e, data) {


                                    var t = $(data.event.target);
                                    if(!t.closest('.jstree').length) {
                                        if(t.closest('.drop').length) {
                                            data.helper.find('.jstree-icon').removeClass('jstree-er').addClass('jstree-ok');
                                        }
                                        else {
                                            data.helper.find('.jstree-icon').removeClass('jstree-ok').addClass('jstree-er');
                                        }
                                    }
                                })
                                .on('dnd_stop.vakata', function (e, data) {
                                    var t = $(data.event.target);


                                    if(!t.closest('.jstree').length) {
                                        if(t.closest('.drop').length) {
                                            //$(data.element).clone().prependTo(t.closest('.drop'));
                                            //console.log($(data.element).clone())
                                            t.closest('.drop').val($(data.element).clone().text());
                                            // node data:
                                             if(data.data.jstree && data.data.origin)
                                             {  //console.log("e",data.element.ngattr('ng-model'))
                                                 console.log('data',data)
                                                 console.log(data.data.origin.get_node(data.element)) }
                                        }
                                    }
                                });*/
                    });
                </script>
            </div>



            <div class=" well">
                <div ng-show="fldCtrl.dataLoaded">
                    <div class="row m-b-sm">
                        <div class="col-md-2">
                            <button type="button" class="btn btn-white btn-sm" ng-click="fldCtrl.refreshTree()"><i class="fa fa-refresh"></i> Refresh</button>
                        </div>
                        <div class="col-md-10">

                                <input ng-model="fldCtrl.treeSearchTerm" ng-change="fldCtrl.applySearch()" type="text" placeholder="Search" class="input-sm form-control">
                                    <!--<span class="input-group-btn">-->
                                        <!--<button type="button" class="btn btn-sm btn-primary"> Go!</button> -->
                                    <!--</span>-->

                        </div>
                    </div>
                    <div draggable-tree tree-data="fldCtrl.treeData"></div>
                    <!--<div id="tree"
                         js-tree="fldCtrl.treeConfig"
                         ng-model="fldCtrl.treeData"
                         tree="fldCtrl.treeInstance"
                         tree-events="changed:fldCtrl.treeChanged;
                         select_node:fldCtrl.nodeSelected;
                         deselect_node:fldCtrl.nodeDeselected;
                         create_node:fldCtrl.createTreeNode;" >
                    </div>-->

                    <div id="myTree" ></div>
                </div>

                <div ng-show="!fldCtrl.dataLoaded" >
                    <div>
                            <div class="sk-spinner sk-spinner-fading-circle">
                                <div class="sk-circle1 sk-circle"></div>
                                <div class="sk-circle2 sk-circle"></div>
                                <div class="sk-circle3 sk-circle"></div>
                                <div class="sk-circle4 sk-circle"></div>
                                <div class="sk-circle5 sk-circle"></div>
                                <div class="sk-circle6 sk-circle"></div>
                                <div class="sk-circle7 sk-circle"></div>
                                <div class="sk-circle8 sk-circle"></div>
                                <div class="sk-circle9 sk-circle"></div>
                                <div class="sk-circle10 sk-circle"></div>
                                <div class="sk-circle11 sk-circle"></div>
                                <div class="sk-circle12 sk-circle"></div>
                            </div>
                    </div>
                </div>

            </div>

        </div>
        <div class="col-md-6">
            <div class="row m-b-sm">
                <div class="pull-left" >
                    <h5>Selected Fields</h5>
                </div>

                <div class="pull-right">
                    <!--<button class="btn btn-default btn-sm btn-outline" ng-click="fldCtrl.addComputedField()">Add Computed Field</button>-->
                    <button type="button" class="btn btn-default btn-sm btn-outline" ng-init="fldCtrl.isCollapsed = true" ng-click="fldCtrl.isCollapsed = !fldCtrl.isCollapsed">Add Computed Field</button>
                    <button class="btn btn-default btn-sm btn-outline" ng-click="fldCtrl.clearFields()">Clear Fields</button>
                </div>
            </div>
            <div class="row m-b-sm">
                <div uib-collapse="fldCtrl.isCollapsed">
                    <div  class="well">
                        <form role="form">
                            <div class="row">
                                <div class="col-md-6">

                                    <div class="form-group">
                                        <label>Name</label>
                                        <input ng-model="fldCtrl.cField.name" type="text" placeholder="Enter Field Name" class="form-control">
                                    </div>
                                    <div class="form-group"><label>Description</label>
                                        <textarea class="form-control" ng-model="fldCtrl.cField.desc"></textarea>
                                    </div>



                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Source Fields</label>
                                        <input type="text" placeholder="Drag Fields here" class="form-control">
                                    </div>

                                    <!--<div class="form-group">
                                            <label>Functions</label>

                                            <ui-select ng-model="fldCtrl.computeFunction" theme="bootstrap" ng-disabled="disabled" on-select="fldCtrl.functionSelected($item, $model)">
                                                <ui-select-match style="height: 29px;" placeholder="Select function...">{{$select.selected.name}}</ui-select-match>
                                                <ui-select-choices group-by="'type'" repeat="func in fldCtrl.computeFunctions | filter:$select.search" position="down">
                                                    {{func.name}}
                                                </ui-select-choices>
                                            </ui-select>
                                    </div>-->



                                    <!--<div class="row">-->
                                    <!--<div class="col-md-6"><label>Text</label>-->
                                    <!--<div class="list-group">-->
                                    <!--<a class="list-group-item">Sever</a>-->
                                    <!--<a class="list-group-item">Moderate</a>-->
                                    <!--<a class="list-group-item">Mild</a>-->
                                    <!--</div>-->
                                    <!--</div>-->
                                    <!--<div class="col-md-6"><label>Numeric Value</label><input type="text" placeholder="Enter Mapping Value"-->
                                    <!--class="form-control">-->
                                    <!--</div>-->
                                    <!--</div>-->
                                </div>
                                <div class="col-md-3">

                                    <div class="form-group">
                                        <label>Functions</label>
                                        <div class="field-list" style="background-color: white; border:1px solid lightgrey; height: 113px; overflow: scroll">
                                            <ul >
                                                <li ng-repeat="func in fldCtrl.computeFunctions"ng-model="fldCtrl.func" ng-click="fldCtrl.addFunc(func)">
                                                    {{func.name}}</li>
                                                <!--ng-class="{'': !isActive, 'selected': isActive}"-->
                                                <!--ng-init="isActive = false"-->
                                                <!--ng-click="isActive = !isActive"-->

                                            </ul>
                                        </div>
                                        <button type="button" class="btn btn-default btn-xs pull-right m-t-xs btn-outline">Insert Function</button>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-8 form-group">
                                    <label>Expression</label>
                                    <div style="background-color: white; border:1px solid lightgrey; padding:2px; height: 100px;overflow: scroll">
                                        <div style="display: inline;" ng-repeat="e in fldCtrl.cField.expressionList track by $index">
                                            <span ng-if="e.type == 'function'" style="color: #d77329;">{{e.name}}</span>

                                            <!-- Droppable area-->
                                            <div ng-if="e.type == 'param' || e.type=='field' " style="padding: 1px;border: 1px solid #e7eaec;border-radius: 2px;margin: 3px; display: inline;"
                                                 data-drop="true"
                                                 jqyoui-droppable="{index: {{$parent.$index}},onDrop:'fldCtrl.dropCallback(e,{{$parent.$index}})'}"
                                                 data-ng-model="e.field">

                                                <!-- Dropped element-->
                                            <span class="label label-info" style="font-size: 10px;
                                                                  font-weight: 300;
                                                                  text-transform: uppercase;
                                                                  text-decoration: underline;
                                                                  margin: 0 2px;"
                                                  ng-show="e.field.fieldName">
                                                <a  ng-click="fldCtrl.remFromExpression(e)" style="color: white;padding-right: 5px;" >
                                                    <i class="fa fa-times-circle-o"></i>
                                                </a>
                                                <span>{{e.field.fieldName}}</span>
                                            </span>
                                                <!-- end of Dropped element-->

                                                <!-- User input if element not dropped-->
                                                <input placeholder="Insert Field here"
                                                       ng-model="e.name"
                                                       ng-hide="e.field.fieldName"
                                                       ng-disabled="e.type == 'function'"
                                                       ng-change="fldCtrl.inputChanged(this)"
                                                       style="background-color:transparent!important; font-size:14px;
                                                               border: none;
                                                               outline: 0;
                                                               /*height: 1.666666em;*/
                                                               /*margin: 4px -10px;*/">
                                                <!-- End of User input-->

                                            </div>

                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4">
                                    <button class="btn btn-white btn-sm" type="submit">Cancel</button>
                                    <button class="btn btn-primary btn-sm" type="submit">Add Field</button>
                                </div>
                            </div>

                        </form>
                    </div>
                </div>

                <div class="well">
                    <ul data-drop="true" data-ng-model="parentCtrl.DS.fields" jqyoui-droppable="{multiple:true}">
                        <li ng-repeat="selField in parentCtrl.DS.fields track by $index" ng-show="selField.displayName">{{selField.displayName}}</li>
                        <li class="placeholder" ng-hide="parentCtrl.DS.fields.length>0">Add your items here</li>
                    </ul>
                </div>
                <!--<div id="testarea"class="well" data-drop="true" data-jqyoui-options ng-model="fldCtrl.list2" jqyoui-droppable style='height:50px;'>
                    <div class="btn btn-success" data-drag="false" data-jqyoui-options ng-model="fldCtrl.list2" jqyoui-draggable ng-hide="!fldCtrl.list2.title">{{fldCtrl.list2.title}}</div>
                </div>-->
            </div>

        </div>



    </div>

    <div class="pull-right">
        <a ng-click="fldCtrl.next()" class="btn btn-primary btn-sm ">Next</a>
        <a ng-click="fldCtrl.cancel()" class="btn btn-primary btn-sm ">Cancel</a>
    </div>


</fieldset>